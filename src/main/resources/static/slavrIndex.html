<!--
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard TXs</title>
    <style>
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          background: #121212;
          color: #fff;
        }

        header {
          background: #1f1f1f;
          padding: 15px 30px;
          font-size: 20px;
          font-weight: bold;
          color: #ff002b;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        main {
          display: flex;
          height: calc(100vh - 60px);
        }

        /* ===== Sidebar cidades ===== */
        #lista-cidades {
          list-style: none;
          padding: 0;
          margin: 0;
          width: 220px;
          border-right: 2px solid #444;
          background: #1f1f1f;
          transition: width 0.3s ease;
          overflow: hidden;
          position: relative;
        }

        #lista-cidades li {
          padding: 12px;
          cursor: pointer;
          transition: background 0.2s;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        #lista-cidades li:hover {
          background: #2c2c2c;
        }

        #lista-cidades li.active {
          background: #cc0022;
          font-weight: bold;
        }

        /* Botão retrátil */
        .toggle-btn {
          position: absolute;
          top: 20px;
          right: -15px;
          width: 30px;
          height: 30px;
          border-radius: 50%;
          border: none;
          background: #cc0022;
          color: white;
          cursor: pointer;
          transition: transform 0.3s;
        }

        #lista-cidades.colapsado {
          width: 50px;
        }

        #lista-cidades.colapsado li {
          text-align: center;
          padding: 15px 0;
        }

        #lista-cidades.colapsado li::after {
          content: "•";
          color: #fff;
          font-size: 18px;
        }

        #lista-cidades.colapsado li span {
          display: none;
        }

        .conteudo {
          flex: 1;
          padding: 20px;
          overflow-y: auto;
        }

        .cidade-info {
          font-size: 18px;
          margin-bottom: 15px;
          color: #ff0831;
        }

        #tx-grid {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
        }

        .tx-container {
          width: calc(25% - 15px);
          box-sizing: border-box;
        }

        .tx-container h3 {
          margin-bottom: 0;
          color: #ff0831;
          cursor: pointer;
          padding: 10px;
          background: #222;
          border-radius: 8px;
          transition: background 0.2s;
        }

        .tx-container h3:hover {
          background: #444;
        }

        .tx-grid-interna {
          display: none;
          margin-top: 10px;
          gap: 10px;
        }

        .tx-container.active .tx-grid-interna {
          display: grid;
          grid-template-columns: 1fr;
        }

        .tx-card {
          background: #333;
          padding: 15px;
          border-radius: 12px;
          text-align: center;
          font-weight: bold;
          transition: transform 0.2s;
        }

        .tx-card:hover {
          transform: scale(1.05);
        }

        h4 {
          margin: 0 0 5px;
        }

        .panel {
          padding: 20px;
        }

        /* Status colors */
        .tx-off { background-color: #1f1f1f; }
        .tx-erro { background-color: #ff002b; }
        .tx-ok { background-color: #2c2c2c; }
        .tx-warning { background-color: #ffd400; color: black; }

    </style>
</head>
<body>

<header>
    <link href="icon.png" rel="icon" type="image/png">
    <span class="status-time" id="dateTime">--:--:--</span>
</header>

<main>
    <ul id="lista-cidades">
        <button class="toggle-btn">⮜</button>
        <li data-id="516"><span>Jaborá SC</span></li>
        <li data-id="1455"><span>Pombos PE</span></li>
        <li data-id="374"><span>Doutor Pedrinho SC</span></li>
        <li data-id="461"><span>Boa Vista do Buricá RS</span></li>
        <li data-id="521"><span>Monte Castelo SC</span></li>
        <li data-id="291"><span>Passira PE</span></li>
    </ul>

    <div class="conteudo">
        <div class="cidade-info" id="cidade-info">Escolha uma cidade...</div>
        <div class="panel">
            <div class="tx-grid" id="tx-grid"></div>
        </div>
    </div>
</main>

<script>
    function renderTXs(data) {
      const cidadeInfo = document.getElementById('cidade-info');
      const grid = document.getElementById('tx-grid');
      cidadeInfo.innerText = data.cidade || "Cidade não encontrada";
      grid.innerHTML = '';

      if (!data.MTXs) {
          grid.innerHTML = '<p style="grid-column: span 4; text-align: center; color: #ff002b;">Nenhum dado disponível</p>';
          return;
      }

      const ordemMTXs = ["MTX1","MTX2","MTX3","MTX4","MTX5","MTX6","MTX7","MTX8"];
      const ordemMetricas = [
          "Potência Direta","Pot. Refletida","MER","Conexão LAN",
          "Resumo de Falhas","Input Lock","Input C/N",
          "RX Sat 1 Lock","RX Sat 2 Lock","RX Sat 1 C/N","RX Sat 2 C/N"
      ];

      ordemMTXs.forEach(txName => {
          const metrics = data.MTXs[txName];
          if (!metrics) return;

          const txContainer = document.createElement('div');
          txContainer.classList.add('tx-container');

          const txTitle = document.createElement('h3');
          txTitle.innerText = txName;
          txContainer.appendChild(txTitle);

          const metricGrid = document.createElement('div');
          metricGrid.classList.add('tx-grid-interna');
          txContainer.appendChild(metricGrid);

          txTitle.addEventListener('click', () => {
              txContainer.classList.toggle('active');
          });

          ordemMetricas.forEach(nomeBonito => {
              const chaveReal = Object.keys(metrics).find(k => k.startsWith(nomeBonito));
              if (!chaveReal) return;

              const valor = metrics[chaveReal];
              const metricDiv = document.createElement('div');
              metricDiv.classList.add('tx-card');

              let statusClass = "tx-ok";
              if (valor.includes("Erro (503)") || valor.includes("ALARME")) statusClass = "tx-erro";
              if (nomeBonito === "Potência Direta" && valor === "0.00 W") statusClass = "tx-erro";
              if (nomeBonito === "Pot. Refletida" && valor === "0.00 W") {
                  const potDiretaKey = Object.keys(metrics).find(k => k.startsWith("Potência Direta"));
                  if (metrics[potDiretaKey] !== "0.00 W") statusClass = "tx-erro";
              }
              if (valor.includes("- não disponível -")) statusClass = "tx-warning";
              else if (valor.includes("N/A")) statusClass = "tx-off";

              metricDiv.classList.add(statusClass);
              metricDiv.innerHTML = `<h4>${nomeBonito}</h4><p>${valor}</p>`;
              metricGrid.appendChild(metricDiv);
          });

          grid.appendChild(txContainer);
      });
  }

  document.querySelectorAll('#lista-cidades li').forEach(li => {
      li.addEventListener('click', () => {
          document.querySelectorAll('#lista-cidades li').forEach(el => el.classList.remove('active'));
          li.classList.add('active');
          const cidadeId = li.getAttribute('data-id');

          fetch(`/api/dashboard/${cidadeId}`)
              .then(res => res.json())
              .then(data => renderTXs(data))
              .catch(err => {
                  console.error(err);
                  alert("Erro ao buscar dados da cidade");
              });
      });
  });

  // Toggle sidebar
  const listaCidades = document.getElementById("lista-cidades");
  const toggleBtn = document.querySelector(".toggle-btn");
  toggleBtn.onclick = () => {
      listaCidades.classList.toggle("colapsado");
      toggleBtn.textContent = listaCidades.classList.contains("colapsado") ? "⮞" : "⮜";
  };

  function atualizarDataHora() {
      const agora = new Date();
      const dataFormatada = agora.toLocaleDateString('pt-BR');
      const horaFormatada = agora.toLocaleTimeString('pt-BR');
      const dateTimeElem = document.getElementById('dateTime');
      if (dateTimeElem) {
          dateTimeElem.textContent = `${dataFormatada} ${horaFormatada}`;
      }
  }

  setInterval(atualizarDataHora, 1000);
</script>

</body>
</html>
-->