<!--
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Dashboard TXs</title>
    <style>
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          background: #121212;
          color: #fff;
        }

        header {
          background: #1f1f1f;
          padding: 15px 30px;
          font-size: 20px;
          font-weight: bold;
          color: #ff002b;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        main {
          display: flex;
          height: calc(100vh - 60px);
        }

        /* ===== Sidebar cidades ===== */
        #lista-cidades {
          list-style: none;
          padding: 0;
          margin: 0;
          width: 220px;
          border-right: 2px solid #444;
          background: #1f1f1f;
          transition: width 0.3s ease;
          overflow: hidden;
          position: relative;
        }

        #lista-cidades li {
          padding: 12px;
          cursor: pointer;
          transition: background 0.2s;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        #lista-cidades li:hover {
          background: #2c2c2c;
        }

        #lista-cidades li.active {
          background: #cc0022;
          font-weight: bold;
        }

        /* Botão retrátil */
        .toggle-btn {
          position: absolute;
          top: 20px;
          right: -15px;
          width: 30px;
          height: 30px;
          border-radius: 50%;
          border: none;
          background: #cc0022;
          color: white;
          cursor: pointer;
          transition: transform 0.3s;
        }

        #lista-cidades.colapsado {
          width: 50px;
        }

        #lista-cidades.colapsado li {
          text-align: center;
          padding: 15px 0;
        }

        #lista-cidades.colapsado li::after {
          content: "•";
          color: #fff;
          font-size: 18px;
        }

        #lista-cidades.colapsado li span {
          display: none;
        }

        .conteudo {
          flex: 1;
          padding: 20px;
          overflow-y: auto;
        }

        .cidade-info {
          font-size: 18px;
          margin-bottom: 15px;
          color: #ff0831;
        }

        #tx-grid {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
        }

        .tx-container {
          width: calc(25% - 15px);
          box-sizing: border-box;
        }

        .tx-container h3 {
          margin-bottom: 0;
          color: #ff0831;
          cursor: pointer;
          padding: 10px;
          background: #222;
          border-radius: 8px;
          transition: background 0.2s;
        }

        .tx-container h3:hover {
          background: #444;
        }

        .tx-grid-interna {
          display: none;
          margin-top: 10px;
          gap: 10px;
        }

        .tx-container.active .tx-grid-interna {
          display: grid;
          grid-template-columns: 1fr;
        }

        .tx-card {
          background: #333;
          padding: 15px;
          border-radius: 12px;
          text-align: center;
          font-weight: bold;
          transition: transform 0.2s;
        }

        .tx-card:hover {
          transform: scale(1.05);
        }

        h4 {
          margin: 0 0 5px;
        }

        .panel {
          padding: 20px;
        }

        /* Status colors */
        .tx-off { background-color: #1f1f1f; }
        .tx-erro { background-color: #ff002b; }
        .tx-ok { background-color: #2c2c2c; }
        .tx-warning { background-color: #ffd400; color: black; }

    </style>
</head>
<body>

<header>
    <link href="icon.png" rel="icon" type="image/png">
    <span class="status-time" id="dateTime">--:--:--</span>
</header>

<main>
    <ul id="lista-cidades">
            <li data-id="885"><span>PR - Capanema</span></li>
            <li data-id="1312"><span>PR - Cafeara</span></li>
            <li data-id="1432"><span>PR - Siqueira Campos</span></li>
            <li data-id="529"><span>SC - Rio Fortuna</span></li>
            <li data-id="397"><span>BA - Igrapiuna</span></li>
            <li data-id="994"><span>BA - Igapora</span></li>
            <li data-id="389"><span>BA - Ibitiara</span></li>
            <li data-id="1452"><span>BA - Ibirapitanga</span></li>
            <li data-id="1329"><span>PR - Cambara</span></li>
            <li data-id="410"><span>PR - Campina da Lagoa</span></li>
            <li data-id="1464"><span>BA - Gloria</span></li>
            <li data-id="411"><span>PR - Campo Bonito</span></li>
            <li data-id="885"><span>PR - Capanema</span></li>
            <li data-id="298"><span>AL - Agua Branca</span></li>
            <li data-id="288"><span>PE - Orobo</span></li>
            <li data-id="1339"><span>PR - Boa Ventura de Sao Roque</span></li>
            <li data-id="1403"><span>PR - Tibagi</span></li>
            <li data-id="500"><span>SC - Angelina</span></li>
            <li data-id="2802"><span>AL - Campo Alegre</span></li>
            <li data-id="1328"><span>PR - Ariranha do Ivai</span></li>
            <li data-id="1338"><span>PR - Arapoti</span></li>
            <li data-id="263"><span>AL - Canapi</span></li>
            <li data-id="532"><span>SC - Salete</span></li>
            <li data-id="419"><span>PR - Cidade Gaucha</span></li>
            <li data-id="1131"><span>BA - Jussari</span></li>
            <li data-id="1289"><span>SC - Sao Martinho</span></li>
            <li data-id="1278"><span>AL - Joaquim Gomes</span></li>
            <li data-id="280"><span>AL - Maravilha</span></li>
            <li data-id="1404"><span>PR - Tres Barras do Parana</span></li>
            <li data-id="467"><span>RS - Casca</span></li>
            <li data-id="1405"><span>PR - Ubirata</span></li>
            <li data-id="387"><span>BA - Elisio Medrado</span></li>
            <li data-id="1134"><span>RJ - Bom Jardim</span></li>
            <li data-id="406"><span>PR - Andira</span></li>
            <li data-id="405"><span>PR - Ampere</span></li>
            <li data-id="1984"><span>RJ - Bom Jesus do Itabapoana</span></li>
            <li data-id="1982"><span>RJ - Casimiro de Abreu</span></li>
            <li data-id="503"><span>SC - Apiuna</span></li>
            <li data-id="1284"><span>SC - Vargem Bonita</span></li>
            <li data-id="1299"><span>PR - Doutor Ulysses</span></li>
            <li data-id="1350"><span>PR - Figueira</span></li>
            <li data-id="376"><span>BA - Curaca</span></li>
            <li data-id="1336"><span>PR - Formosa do Oeste</span></li>
            <li data-id="508"><span>SC - Capinzal</span></li>
            <li data-id="1361"><span>SC - Caxambu do Sul</span></li>
            <li data-id="919"><span>SC - Coronel Freitas</span></li>
            <li data-id="1382"><span>PR - Guapirama</span></li>
            <li data-id="1383"><span>PR - Guaraniacu</span></li>
            <li data-id="413"><span>SC - Vidal Ramos</span></li>
            <li data-id="407"><span>SC - Vitor Meireles</span></li>
            <li data-id="287"><span>AL - Sao Bras</span></li>
            <li data-id="2806"><span>RJ - Natividade</span></li>
            <li data-id="1502"><span>AL - Sao Jose da Laje</span></li>
            <li data-id="1410"><span>RS - Cacique Doble</span></li>
            <li data-id="1273"><span>AL - Sao Jose da Tapera</span></li>
            <li data-id="275"><span>PE - Jurema</span></li>
            <li data-id="1521"><span>PE - Parnamirim</span></li>
            <li data-id="291"><span>PE - Passira</span></li>
            <li data-id="476"><span>RS - Ibiaca</span></li>
            <li data-id="352"><span>BA - Castro Alves</span></li>
            <li data-id="477"><span>RS - Ibiraiaras</span></li>
            <li data-id="509"><span>SC - Descanso</span></li>
            <li data-id="1371"><span>SC - Dona Emma</span></li>
            <li data-id="358"><span>BA - Capela do Alto Alegre</span></li>
            <li data-id="478"><span>RS - Independencia</span></li>
            <li data-id="209"><span>PE - Aguas Belas</span></li>
            <li data-id="481"><span>RS - Manoel Viana</span></li>
            <li data-id="1493"><span>SE - Capela</span></li>
            <li data-id="1455"><span>PE - Pombos</span></li>
            <li data-id="353"><span>BA - Maetinga</span></li>
            <li data-id="510"><span>SC - Erval Velho</span></li>
            <li data-id="377"><span>BA - Wagner</span></li>
            <li data-id="1501"><span>PE - Altinho</span></li>
            <li data-id="1180"><span>PE - Amaraji</span></li>
            <li data-id="692"><span>RS - Porto Lucena</span></li>
            <li data-id="2804"><span>PE - Barra de Guabiraba</span></li>
            <li data-id="3652"><span>RS - Progresso</span></li>
            <li data-id="1293"><span>PE - Barreiros</span></li>
            <li data-id="3092"><span>BA - Varzedo</span></li>
            <li data-id="1420"><span>RS - Putinga</span></li>
            <li data-id="5026"><span>RS - Roca Sales</span></li>
            <li data-id="1351"><span>PR - Imbau</span></li>
            <li data-id="1316"><span>AL - Sao Sebastiao</span></li>
            <li data-id="N/A"><span>AL - Tanque d Arca</span></li>
            <li data-id="273"><span>PE - Jupi</span></li>
            <li data-id="1319"><span>AL - Teotonio Vilela</span></li>
            <li data-id="491"><span>RS - Santa Barbara do Sul</span></li>
            <li data-id="2858"><span>PE - Jucati</span></li>
            <li data-id="1440"><span>PE - Belem do Sao Francisco</span></li>
            <li data-id="223"><span>PE - Brejao</span></li>
            <li data-id="3692"><span>RS - Sao Jose do Herval</span></li>
            <li data-id="10610"><span>RS - Tapera</span></li>
            <li data-id="1146"><span>PR - Iretama</span></li>
            <li data-id="366"><span>BA - Ubaira</span></li>
            <li data-id="1424"><span>RS - Tupancireta</span></li>
            <li data-id="425"><span>PR - Ivai</span></li>
            <li data-id="270"><span>PE - Joao Alfredo</span></li>
            <li data-id="1385"><span>PR - Joaquim Tavora</span></li>
            <li data-id="1357"><span>SC - Ipira</span></li>
            <li data-id="1327"><span>SC - Ipora do Oeste</span></li>
            <li data-id="1143"><span>PE - Jatoba</span></li>
            <li data-id="359"><span>BA - Agua Fria</span></li>
            <li data-id="1425"><span>RS - Vila Flores</span></li>
            <li data-id="1165"><span>PE - Cachoeirinha</span></li>
            <li data-id="1427"><span>SC - Agrolandia</span></li>
            <li data-id="1977"><span>PE - Calcado</span></li>
            <li data-id="1477"><span>PE - Sanharo</span></li>
            <li data-id="N/A"><span>PE - Santa Maria do Cambuca</span></li>
            <li data-id="1480"><span>PE - Santa Terezinha</span></li>
            <li data-id="239"><span>PE - Capoeiras</span></li>
            <li data-id="1978"><span>SC - Jaguaruna</span></li>
            <li data-id="245"><span>SE - Neopolis</span></li>
            <li data-id="1446"><span>PE - Condado</span></li>
            <li data-id="1363"><span>PE - Cortes</span></li>
            <li data-id="1389"><span>PR - Paraiso do Norte</span></li>
            <li data-id="2556"><span>PR - Pien</span></li>
            <li data-id="333"><span>BA - Muquem de Sao Francisco</span></li>
            <li data-id="1250"><span>BA - Nilo Pecanha</span></li>
            <li data-id="357"><span>BA - Aracas</span></li>
            <li data-id="2864"><span>PE - Xexeu</span></li>
            <li data-id="326"><span>BA - Nova Redencao</span></li>
            <li data-id="1522"><span>PE - Itacuruba</span></li>
            <li data-id="371"><span>BA - Arataca</span></li>
            <li data-id="254"><span>PE - Cumaru</span></li>
            <li data-id="438"><span>PR - Pinhao</span></li>
            <li data-id="523"><span>SC - Nova Erechim</span></li>
            <li data-id="439"><span>PR - Planalto</span></li>
            <li data-id="1433"><span>PE - Sao Joaquim do Monte</span></li>
            <li data-id="1133"><span>SC - Papanduva</span></li>
            <li data-id="246"><span>SE - Riachao do Dantas</span></li>
            <li data-id="363"><span>BA - Barrocas</span></li>
            <li data-id="402"><span>SC - Peritiba</span></li>
            <li data-id="527"><span>SC - Pinheiro Preto</span></li>
            <li data-id="1271"><span>BA - Pojuca</span></li>
            <li data-id="1317"><span>SC - Piratuba</span></li>
            <li data-id="391"><span>BA - Ponto Novo</span></li>
            <li data-id="393"><span>BA - Presidente Tancredo Neves</span></li>
            <li data-id="443"><span>PR - Querencia do Norte</span></li>
            <li data-id="256"><span>PE - Custodia</span></li>
            <li data-id="1511"><span>PE - Exu</span></li>
            <li data-id="1305"><span>SC - Rio do Campo</span></li>
            <li data-id="549"><span>ES - Pinheiros</span></li>
            <li data-id="2262"><span>SC - Rio do Oeste</span></li>
            <li data-id="336"><span>BA - Belmonte</span></li>
            <li data-id="2297"><span>BA - Sao Jose da Vitoria</span></li>
            <li data-id="1478"><span>PE - Gameleira</span></li>
            <li data-id="8099"><span>PE - Gravata</span></li>
            <li data-id="448"><span>PR - Rio Bonito do Iguacu</span></li>
            <li data-id="1517"><span>PE - Ibimirim</span></li>
            <li data-id="307"><span>PE - Sao Jose do Belmonte</span></li>
            <li data-id="451"><span>PR - Salto do Lontra</span></li>
            <li data-id="1529"><span>PE - Sao Jose do Egito</span></li>
            <li data-id="1398"><span>PR - Santo Inacio</span></li>
            <li data-id="1399"><span>PR - Sao Joao do Caiua</span></li>
            <li data-id="1491"><span>PE - Terezinha</span></li>
            <li data-id="1492"><span>PE - Toritama</span></li>
            <li data-id="1495"><span>PE - Trindade</span></li>
            <li data-id="1136"><span>ES - Dores do Rio Preto</span></li>
            <li data-id="1498"><span>PE - Tuparetama</span></li>
            <li data-id="2742"><span>ES - Ecoporanga</span></li>
            <li data-id="1207"><span>ES - Ibiracu</span></li>
            <li data-id="310"><span>BA - Serra Dourada</span></li>
            <li data-id="368"><span>BA - Jitauna</span></li>
            <li data-id="400"><span>BA - Itapitanga</span></li>
            <li data-id="384"><span>BA - Itaju do Colonia</span></li>
            <li data-id="1428"><span>SC - Anchieta</span></li>
            <li data-id="1310"><span>AL - Cajueiro</span></li>
            <li data-id="1505"><span>AL - Igaci</span></li>
            <li data-id="300"><span>AL - Igreja Nova</span></li>
            <li data-id="266"><span>AL - Jequia da Praia</span></li>
            <li data-id="456"><span>PR - Wenceslau Braz</span></li>
            <li data-id="1902"><span>SC - Benedito Novo</span></li>
            <li data-id="1451"><span>BA - Crisopolis</span></li>
            <li data-id="539"><span>RS - Cambara do Sul</span></li>
            <li data-id="1449"><span>BA - Coaraci</span></li>
            <li data-id="1471"><span>BA - Cipo</span></li>
            <li data-id="2809"><span>PE - Panelas</span></li>
            <li data-id="322"><span>BA - Chorrocho</span></li>
            <li data-id="1219"><span>SE - Boquim</span></li>
            <li data-id="243"><span>SE - Brejo Grande</span></li>
            <li data-id="1457"><span>BA - Lapao</span></li>
            <li data-id="1075"><span>PE - Pocao</span></li>
            <li data-id="1459"><span>PE - Primavera</span></li>
            <li data-id="1466"><span>PE - Quipapa</span></li>
            <li data-id="341"><span>BA - Malhada de Pedras</span></li>
            <li data-id="274"><span>AL - Sao Miguel dos Milagres</span></li>
            <li data-id="221"><span>PE - Betania</span></li>
            <li data-id="1441"><span>PE - Bonito</span></li>
            <li data-id="10796"><span>RS - Sao Vicente do Sul</span></li>
            <li data-id="1258"><span>SE - Japoata</span></li>
            <li data-id="1355"><span>PR - Laranjal</span></li>
            <li data-id="1445"><span>PE - Cabrobo</span></li>
            <li data-id="5318"><span>PE - Carnaiba</span></li>
            <li data-id="250"><span>PE - Carnaubeira da Penha</span></li>
            <li data-id="1388"><span>PR - Nova Cantu</span></li>
            <li data-id="437"><span>PR - Pinhalao</span></li>
            <li data-id="342"><span>BA - Mulungu do Morro</span></li>
            <li data-id="343"><span>BA - Antonio Goncalves</span></li>
            <li data-id="542"><span>PE - Itaiba</span></li>
            <li data-id="440"><span>PR - Pranchita</span></li>
            <li data-id="1474"><span>PE - Vertentes</span></li>
            <li data-id="1248"><span>SE - Ribeiropolis</span></li>
            <li data-id="1203"><span>ES - Anchieta</span></li>
            <li data-id="547"><span>ES - Apiaca</span></li>
            <li data-id="1107"><span>ES - Atilio Vivacqua</span></li>
            <li data-id="1252"><span>SE - Umbauba</span></li>
            <li data-id="329"><span>BA - Cachoeira</span></li>
            <li data-id="551"><span>ES - Piuma</span></li>
            <li data-id="1453"><span>BA - Sao Felix do Coribe</span></li>
            <li data-id="1518"><span>PE - Ibirajuba</span></li>
            <li data-id="32"><span>PE - Sertania</span></li>
            <li data-id="383"><span>BA - Tanquinho</span></li>
            <li data-id="315"><span>PE - Tacaimbo</span></li>
            <li data-id="1298"><span>PE - Triunfo</span></li>
            <li data-id="1188"><span>ES - Conceicao do Castelo</span></li>

        </ul>

        <div class="conteudo">
        <div class="cidade-info" id="cidade-info">Escolha uma cidade...</div>
        <div class="panel">
            <div class="tx-grid" id="tx-grid"></div>
        </div>
    </div>
</main>

<script>
    function renderTXs(data) {
      const cidadeInfo = document.getElementById('cidade-info');
      const grid = document.getElementById('tx-grid');
      cidadeInfo.innerText = data.cidade || "Cidade não encontrada";
      grid.innerHTML = '';

      if (!data.MTXs) {
          grid.innerHTML = '<p style="grid-column: span 4; text-align: center; color: #ff002b;">Nenhum dado disponível</p>';
          return;
      }

      const ordemMTXs = ["MTX1","MTX2","MTX3","MTX4","MTX5","MTX6","MTX7","MTX8"];
      const ordemMetricas = [
          "Potência Direta","Pot. Refletida","MER","Conexão LAN",
          "Resumo de Falhas","Input Lock","Input C/N",
          "RX Sat 1 Lock","RX Sat 2 Lock","RX Sat 1 C/N","RX Sat 2 C/N"
      ];

      ordemMTXs.forEach(txName => {
          const metrics = data.MTXs[txName];
          if (!metrics) return;

          const txContainer = document.createElement('div');
          txContainer.classList.add('tx-container');

          const txTitle = document.createElement('h3');
          txTitle.innerText = txName;
          txContainer.appendChild(txTitle);

          const metricGrid = document.createElement('div');
          metricGrid.classList.add('tx-grid-interna');
          txContainer.appendChild(metricGrid);

          txTitle.addEventListener('click', () => {
              txContainer.classList.toggle('active');
          });

          ordemMetricas.forEach(nomeBonito => {
              const chaveReal = Object.keys(metrics).find(k => k.startsWith(nomeBonito));
              if (!chaveReal) return;

              const valor = metrics[chaveReal];
              const metricDiv = document.createElement('div');
              metricDiv.classList.add('tx-card');

              let statusClass = "tx-ok";
              if (valor.includes("Erro (503)") || valor.includes("ALARME")) statusClass = "tx-erro";
              if (nomeBonito === "Potência Direta" && valor === "0.00 W") statusClass = "tx-erro";
              if (nomeBonito === "Pot. Refletida" && valor === "0.00 W") {
                  const potDiretaKey = Object.keys(metrics).find(k => k.startsWith("Potência Direta"));
                  if (metrics[potDiretaKey] !== "0.00 W") statusClass = "tx-erro";
              }
              if (valor.includes("- não disponível -")) statusClass = "tx-warning";
              else if (valor.includes("N/A")) statusClass = "tx-off";

              metricDiv.classList.add(statusClass);
              metricDiv.innerHTML = `<h4>${nomeBonito}</h4><p>${valor}</p>`;
              metricGrid.appendChild(metricDiv);
          });

          grid.appendChild(txContainer);
      });
  }

  document.querySelectorAll('#lista-cidades li').forEach(li => {
      li.addEventListener('click', () => {
          document.querySelectorAll('#lista-cidades li').forEach(el => el.classList.remove('active'));
          li.classList.add('active');
          const cidadeId = li.getAttribute('data-id');

          fetch(`/api/dashboard/${cidadeId}`)
              .then(res => res.json())
              .then(data => renderTXs(data))
              .catch(err => {
                  console.error(err);
                  alert("Erro ao buscar dados da cidade");
              });
      });
  });

  // Toggle sidebar
  const listaCidades = document.getElementById("lista-cidades");
  const toggleBtn = document.querySelector(".toggle-btn");
  toggleBtn.onclick = () => {
      listaCidades.classList.toggle("colapsado");
      toggleBtn.textContent = listaCidades.classList.contains("colapsado") ? "" : "";
  };

  function atualizarDataHora() {
      const agora = new Date();
      const dataFormatada = agora.toLocaleDateString('pt-BR');
      const horaFormatada = agora.toLocaleTimeString('pt-BR');
      const dateTimeElem = document.getElementById('dateTime');
      if (dateTimeElem) {
          dateTimeElem.textContent = `${dataFormatada} ${horaFormatada}`;
      }
  }

  setInterval(atualizarDataHora, 1000);
</script>

</body>
</html>
-->